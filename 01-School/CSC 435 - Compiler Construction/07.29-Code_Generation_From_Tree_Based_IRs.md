a continuation of [code generation](07.15-Code_Generation)
These techniques are mostly used for CISC devices, like x86
We're going to assume that we have a very low-level IR, and that we have few relatively few templates to convert the IR to machine code.
The instructions we'll have:
- load 
- store
- register copy
- various expression assignments
$R_j$ will be a register from $R_0,...R_{m-1}$
M is a memory location

Here's the idea: We have some tree
![[Pasted image 20250729125448.png]]
we suppose the optimal code will be:
- the optimal code for T1
- the optimal code for T2
- the code for op

### Aho & Johnson algorithm
Three phases:
#### Phase 1
We traverse the tree bottom-up, calculating the cost C\[i\] for each node .
C\[i\] is the optimal cost for a subtree of node n, given at most i registers.

each instructions operands are either in registers or in memory. 
For each subtree:
- the cost of the first register operand is C\[i\]
- the cost of the second register operand is C\[i-1\]
- and so on.
We want to try all possible orders of evaluating operands to find the one with the lowest cost.
![[Pasted image 20250729130317.png]]
\[a,b,c\] are the values for C\[0\], C\[1\], C\[2\]
the cost for just the node a = \[0,1,1\]. if we have no registers, is costs nothing to have a in memory. If we do have a register, it has a cost of one to store. Having more then one register doesn't help

what about the node `a-b`? 
![[Pasted image 20250729130723.png]]
![[Pasted image 20250729130737.png]]

#### Phase 2
Now, we traverse the tree top-down. We want to find all the points where C\[0\] was used in the optimal solution. We then generate code for this specific points.
#### Phase 3
traverse the tree top to bottom again, post-order traversal this time (left-right-root). 
We output the instruction for each node we visit.
### Static Single Assignment (SSA)
Nowadays, we don't use Aho & Johnson for code generation. Instead, we use Single Static Assignment, which uses a graph instead of a tree.
It's a very large topic, so it won't be fully covered in this class, but it's an introduction.

